<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net472</TargetFramework>
  </PropertyGroup>

	<PropertyGroup>
		<PackageId>Umbraco.Forms.Integrations.Crm.Hubspot</PackageId>
		<Title>Umbraco Forms Integrations: CRM - Hubspot</Title>
		<Description>An extension for Umbraco Forms to add support for submitting data to Hubspot</Description>
		<PackageIconUrl></PackageIconUrl>
		<PackageProjectUrl>https://github.com/umbraco/Umbraco.Forms.Integrations</PackageProjectUrl>
		<RepositoryUrl>https://github.com/umbraco/Umbraco.Forms.Integrations</RepositoryUrl>
		<Version>1.0.0</Version>
		<Authors>Umbraco HQ</Authors>
		<Company>Umbraco</Company>
	</PropertyGroup>

  <ItemGroup>
    <PackageReference Include="MSBuild.Umbraco.Packaging" Version="1.0.2">
      <PrivateAssets>all</PrivateAssets>
    </PackageReference>
    <PackageReference Include="UmbracoCms.Web" Version="8.1.0" />
    <PackageReference Include="UmbracoForms.Core" Version="8.7.4" />
  </ItemGroup>

  <ItemGroup>
    <Content Include="App_Plugins\UmbracoForms.Integrations\Crm\Hubspot\**\*.*">
      <Pack>true</Pack>
      <PackagePath>content\App_Plugins\UmbracoForms.Integrations\Crm\Hubspot\</PackagePath>
    </Content>
  </ItemGroup>

  <ItemGroup>
    <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleToAttribute">
      <_Parameter1>Umbraco.Forms.Integrations.Crm.Hubspot.Tests</_Parameter1>
    </AssemblyAttribute>
  </ItemGroup>

  <!-- Copy App_Plugins files to test site when developing locally -->
  <Target Name="PostBuild" AfterTargets="PostBuildEvent" Condition="'$(Configuration)' == 'Debug'">
    <Exec Command="xcopy /E /Y /I &quot;$(ProjectDir)App_Plugins\UmbracoForms.Integrations\Crm\Hubspot&quot; &quot;$(SolutionDir)\Umbraco.Forms.Integrations.TestSite\App_Plugins\UmbracoForms.Integrations\Crm\Hubspot&quot;&#xD;&#xA;EXIT 0" />
  </Target>

  <!--
  Create Umbraco package zip along with NuGet when dotnet pack is called.
  See and hat-tip:
   - https://24days.in/umbraco-cms/2019/umbraco-packages-2019/packaging/
   - https://github.com/callumbwhyte/msbuild-umbraco-packaging
  -->
  <UsingTask AssemblyFile="$(TargetDir)\MSBuild.Umbraco.Packaging.dll" TaskName="MSBuild.Umbraco.Packaging.GatherAssemblies" />

  <Target Name="UmbracoGatherFiles">
    <GatherAssemblies Dependencies="@(ReferenceCopyLocalPaths)"
              PackageRefs="@(PackageReference);@(ProjectReference)">
      <Output TaskParameter="Assemblies" ItemName="PackageAssemblies" />
    </GatherAssemblies>

    <Copy SourceFiles="$(TargetPath)" DestinationFolder="$(TempFolder)\bin\" />
    <Copy SourceFiles="@(PackageAssemblies)" DestinationFolder="$(TempFolder)\bin\" />

    <Copy SourceFiles="@(Content)" DestinationFiles="$(TempFolder)%(RelativeDir)%(Filename)%(Extension)" />
  </Target>

  <UsingTask AssemblyFile="$(TargetDir)\MSBuild.Umbraco.Packaging.dll" TaskName="MSBuild.Umbraco.Packaging.GenerateManifest" />

  <Target Name="UmbracoPackage" AfterTargets="Pack" DependsOnTargets="UmbracoClean;UmbracoGatherFiles">
    <GenerateManifest TargetDirectory="$(TempFolder)"
              Name="$(Product)"
              Description="$(Description)"
              Version="$(Version)"
              UmbracoVersion="$(UmbracoVersion)"
              Author="$(Authors)"
              AuthorUrl="$(AuthorUrl)"
              ProjectUrl="$(PackageProjectUrl)"
              IconUrl="$(PackageIconUrl)"
              LicenseUrl="$(PackageLicenseUrl)" />
  </Target>

  <Target Name="UmbracoPackage" AfterTargets="Pack" DependsOnTargets="UmbracoClean;UmbracoGatherFiles">
    <ZipDirectory SourceDirectory="$(TempFolder)"
            DestinationFile="$(DestFolder)\$(Product).$(Version).zip"
            Overwrite="true" />
  </Target>

  <Target Name="UmbracoClean" AfterTargets="Clean">
    <RemoveDir Directories="$(TempFolder)" />
  </Target>

</Project>
